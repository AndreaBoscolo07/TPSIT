<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NumeroMania</title>
    <style>
        /* Stili invariati */
    </style>
</head>
<body>
    <div class="contenitore-gioco">
        <h1>NumeroMania</h1>
        <p>Divertiti con le operazioni matematiche!</p>

        <div id="area-nome-utente">
            <input type="text" id="nome-utente" placeholder="Inserisci il tuo nome" />
            <button id="inizia-gioco">Inizia il Gioco</button>
        </div>

        <div id="pulsante-gioco-avviato">
            <div id="informazioni-livello">
                <p><strong>Nome: </strong><span id="nome-giocatore">?</span></p>
                <p><strong>Livello: </strong><span id="numero-livello">1</span></p>
                <p><strong>Tempo: </strong><span id="timer">30</span> secondi</p>
            </div>

            <div id="area-sfida">
                <p>Quanto fa <span id="sfida-operazione"></span>?</p>
                <input type="number" id="risposta-giocatore" placeholder="Rispondi qui">
                <button id="invia-risposta">Invia risposta</button>
                <p id="messaggio-risultato"></p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let livello = 1;
            let sfidaCorrente;
            let rispostaCorretta;
            let tempoRimanente = 30;
            let intervalloTimer;
            let livelliNonCompletati = 0;
            let nomeUtente = '';

            document.getElementById('inizia-gioco').addEventListener('click', function() {
                nomeUtente = document.getElementById('nome-utente').value.trim();

                if (nomeUtente) {
                    document.getElementById('area-nome-utente').style.display = 'none';
                    document.getElementById('pulsante-gioco-avviato').style.display = 'block';
                    document.getElementById('nome-giocatore').textContent = nomeUtente;
                    iniziaLivello(livello);
                } else {
                    alert("Per favore, inserisci il tuo nome!");
                }
            });

            function iniziaLivello(livello) {
                document.getElementById('numero-livello').textContent = livello;
                document.getElementById('timer').textContent = tempoRimanente;
                generaSfida(livello);
                avviaTimer();
            }

            function generaSfida(livello) {
                let num1, num2;

                if (livello <= 5) {
                    num1 = Math.floor(Math.random() * 50) + 10;
                    num2 = Math.floor(Math.random() * 50) + 10;
                    rispostaCorretta = num1 + num2;
                    sfidaCorrente = num1 + " + " + num2;
                } else if (livello <= 10) {
                    num1 = Math.floor(Math.random() * 50) - 25;
                    num2 = Math.floor(Math.random() * 50) - 25;
                    rispostaCorretta = num1 - num2;
                    sfidaCorrente = num1 + " - " + num2;
                } else {
                    num1 = Math.floor(Math.random() * 15) + 2;
                    num2 = Math.floor(Math.random() * 10) + 2;
                    rispostaCorretta = num1 * num2;
                    sfidaCorrente = num1 + " Ã— " + num2;
                }

                document.getElementById('sfida-operazione').textContent = sfidaCorrente;
            }

            function avviaTimer() {
                intervalloTimer = setInterval(function() {
                    tempoRimanente--;
                    document.getElementById('timer').textContent = tempoRimanente;
                    if (tempoRimanente <= 0) {
                        clearInterval(intervalloTimer);
                        controllaRisultato();
                    }
                }, 1000);
            }

            document.getElementById('invia-risposta').addEventListener('click', function() {
                let rispostaUtente = parseInt(document.getElementById('risposta-giocatore').value.trim());

                if (isNaN(rispostaUtente)) {
                    alert("Per favore, inserisci un numero!");
                    return;
                }

                controllaRisultato(rispostaUtente);
            });

            function controllaRisultato(rispostaUtente) {
                if (rispostaUtente === rispostaCorretta) {
                    document.getElementById('messaggio-risultato').textContent = "Risposta corretta!";
                    livello++;
                    livelliNonCompletati = 0;
                } else {
                    document.getElementById('messaggio-risultato').textContent = "Risposta errata!";
                    livelliNonCompletati++;
                    if (livelliNonCompletati >= 3) {
                        fineGioco();
                        return;
                    }
                }

                setTimeout(function() {
                    if (livelliNonCompletati < 3) {
                        tempoRimanente = 30;
                        iniziaLivello(livello);
                    }
                }, 2000);
            }

            function fineGioco() {
                document.querySelector('.contenitore-gioco').innerHTML = `
                    <div class="fine-gioco">
                        <h1>Game Over</h1>
                        <p>Hai completato ${livello - 1} livelli. Grazie per aver giocato!</p>
                    </div>`;
            }
        });
    </script>

</body>
</html>
